	on_daily = {
		every_country = { #add every country not in array with value x to array
			limit = {
				has_opinion = { target = ROOT value > 20 }
 				NOT = { 
					is_in_array = { 
						value = THIS.id 
						array = ROOT.db_diplomacy_friendly
					} 
				}
			}
			add_to_array = { 
				array = ROOT.db_diplomacy_friendly
					value = THIS.id
			}
		}
	}
	
	on_daily = {
		for_each_scope_loop = {
			array = ROOT.db_diplomacy_friendly
			if = {
				limit = { NOT = { has_opinion_modifier = db_established_relations } }
				country_event = db_diplomacy.1
				add_opinion_modifier = {
					target = ROOT
					modifier = db_established_relations
				}
			}
		}	
	}
	
#		every_country = { 
#		limit = { 
#			has_opinion = { 
#				target = ROOT 
#				value > 20 
#			} 
#
#			add_to_array = { ROOT.db_diplomacy_friendly = PREV } 
#			}
#	}
	
	
	
##unfinished ideas
#	on_weekly = {
#		effect = {
#			any_country = {
#				limit = { 
#					has_opinion	= {
#						target = ROOT
#					}
#					NOT = { has_opinion_modifier = db_established_relations } 
#				}
#				save_event_target_as = db_diplomacy_establish_relations_FROM
#			}
#			event_target:db_diplomacy_establish_relations_FROM = { 
#				country_event = { 
#					id = db_diplomacy.1 
#					#days = 5
#					#random_hours = 12
##					#random_days = 5 
#				}
#				add_opinion_modifier = {
#					target = ROOT
#					modifier = db_established_relations
#				}
#			} 
#		}
#	}

#every_country = { limit = { has_opinion = { target = ROOT value < 20 } is_in_array = { value = PREV array = ROOT.db_diplomacy_friendly } } remove_from_array = { array = ROOT.db_diplomacy_friendly value = PREV } }
#every_country = { limit = { is_in_array = { value = PREV array = ROOT.db_diplomacy_friendly } } country_event = db_diplomacy.1 }

on_startup = {
	effect = {
		every_state = {
			limit = {
				is_controlled_by = ROOT
			}
			add_to_array = {
				array = ROOT.controlled_state_ids
				value = THIS.id
			}
		}
	}
}

on_weekly = {
	effect = {
		every_state = {
			limit = {
				is_controlled_by = ROOT
			}
		add_to_array = {
			array = ROOT.controlled_state_ids
			value = THIS.id
		}
	}
	if = {
		limit = {
			any_state = {
				limit = { NOT = { is_controlled_by = ROOT } }
				is_in_array = {
					array = ROOT.controlled_state_ids
					value = THIS.id
				}
				remove_from_array = {
					array = ROOT.controlled_state_ids
					value = THIS.id
				}
			}
		}
	}
}

on_startup = {
	effect = {
		set_variable = {
			var = total_state_conservative
			value = 0
		}
		set_variable = {
			var = total_state_liberal
			value = 0
		}
		set_variable = {
			var = total_state_neutrality
			value = 0
		}
		set_variable = {
			var = total_state_communism
			value = 0
		}
		set_variable = {
			var = total_state_fascism
			value = 0
		}
		for_each_scope_loop = {
			array = ROOT.controlled_state_ids
			set_temp_variable = {
				var = governor_chance_democratic
				value = party_popularity_100@democratic	
			}
			set_temp_variable = {
				var = governor_chance_neutrality
				value = party_popularity_100@neutrality
			}
			set_temp_variable = {
				var = governor_chance_communism
				value = party_popularity_100@communism
			}
			set_temp_variable = {
				var = governor_chance_fascism
				value = party_popularity_100@fascism
			}
			random_list = {
				var:governor_chance_democratic = {
					random_list = {
						10 = {
							db_effect_state_set_conservative = yes
							modifier = { factor = 2 has_country_leader_ideology = conservatism }
							generate_character = {
								token_base = PREV.governor # token will be TAG_token_base
								advisor = {
									slot = political_advisor
									traits = { liberal_governor }
									available = {
										PREV = { has_state_flag = db_state_conservative }
										ROOT = { controls_state = PREV }	
									}
								}		
								portraits = { 
									army = { small = GFX_idea_generic_fascist_demagogue }
								}
							}
						}
						10 = {
							db_effect_state_set_liberal = yes
							modifier = { factor = 2 has_country_leader_ideology = liberalism }
							generate_character = {
								token_base = PREV.governor # token will be TAG_token_base
								advisor = {
									slot = political_advisor
									traits = { liberal_governor }
									available = {
										PREV = { has_state_flag = state_1_neutral }
										ROOT = { controls_state =  PREV }	
									}
								}		
								portraits = { 
									army = { small = GFX_idea_generic_fascist_demagogue }
								}
							}
						}
					}
				}
				var:governor_chance_neutrality = {
					db_effect_state_set_neutral = yes
					generate_character = {
						token_base = PREV.governor # token will be TAG_token_base
						advisor = {
							slot = political_advisor
								traits = { neutral_governor }
								available = {
									PREV = { has_state_flag = db_state_neutrality }
									ROOT = { controls_state =  PREV }
								}
							}		
						portraits = { 
							army = { small = GFX_idea_generic_fascist_demagogue }
						}
					}
				}	
				var:governor_chance_communism = {
					db_effect_state_set_communism = yes
					generate_character = {
						token_base = PREV.governor # token will be TAG_token_base
						advisor = {
							slot = political_advisor
								traits = { communist_governor }
								available = {
									PREV = { has_state_flag = db_state_communist }
									ROOT = { controls_state =  PREV }
								}
							}		
						portraits = { 
							army = { small = GFX_idea_generic_fascist_demagogue }
						}
					}
				}
				var:governor_chance_fascism = {
					db_effect_state_set_neutral = yes
					generate_character = {
						token_base = PREV.governor # token will be TAG_token_base
						advisor = {
							slot = political_advisor
								traits = { fascist_governor }
								available = {
									PREV = { has_state_flag = db_state_fascist }
									ROOT = { controls_state =  PREV }
								}
							}		
						portraits = { 
							army = { small = GFX_idea_generic_fascist_demagogue }
						}
					}
				}
			}
		}
	}
}

on_weekly = {
	effect = {
		every_state = {
			limit = {
				is_in_array = ROOT.controlled_state_ids
			}
			if = { 
				limit = { 
				PREV = { has_state_flag = db_state_liberal } 
					NOT = { 
						has_dynamic_modifier = {
							modifier = my_dynamic_modifier
							scope = GER
						}
					}
				}
			}
		}
		
	}
db_state_modifier_conservative = {}
db_state_modifier_liberal = {}
db_state_modifier_fascist = {}
db_state_modifier_neutral = {}
db_state_modifier_communist = {}

}

ROOT = {
	set_variable = {
		var = total_state_conservative
		value = 0
	}
	set_variable = {
		var = total_state_liberal
		value = 0
	}
	set_variable = {
		var = total_state_neutral
		value = 0
	}
	set_variable = {
		var = total_state_communist
		value = 0
	}
	set_variable = {
		var = total_state_fascist
		value = 0
	}	
	every_state = {
		set_event_target = db_election_state
		add_to_variable = {
			var = THIS.election_chance
			value = 0
		}
		add_to_variable = {
			var = THIS.election_chance
			value = stability
		}
		add_to_variable = {
			var = THIS.election_chance
			value = has_war_support
		}
		add_to_variable = {
			var = THIS.election_chance
			value = party_popularity@ruling_party
		}
		add_to_variable = {
			var = THIS.election_chance
			value = political_power_daily
		}
		if = {
			limit = { THIS = { is_core_of = ROOT } }
			divide_variable = {
				var = THIS.election_chance
				value = 5
			}
			clamp_variable = {
				var = THIS.election_chance
				min = 0
				max = 1
			}
			add_to_variable = {
				var = THIS.election_chance_lose
				value = 1
			}
			subtract_from_variable = {
				var = THIS.election_chance_lose
				value = THIS.election_chance
			}
		}
		if = {
			limit = { THIS = { NOT = { is_core_of = ROOT } } }
			add_to_variable = {
				var = THIS.election_chance
				value = resistance
			}
				add_to_variable = {
				var = THIS.election_chance
				value = compliance
			}
				divide_variable = {
				var = THIS.election_chance
				value = 7
			}
			clamp_variable = {
				var = THIS.election_chance
				min = 0
				max = 1
			}
			add_to_variable = {
				var = THIS.election_chance_lose
				value = 1
			}
			subtract_from_variable = {
				var = THIS.election_chance_lose
				value = THIS.election_chance
			}
		}
		random_list = {
			var:THIS.election_chance = {
				random_list = {
					10 = {
						set_state_flag = db_state_conservative
						PREV = {
							add_to_variable = {
								var = total_state_conservative
								value = 1
								tooltip = add_total_state_conservative
							}
						}
						add_dynamic_modifier = {
							modifier = db_state_modifier_conservative
							scope = THIS
							
						}
						modifier = { factor = 2 PREV = { has_country_leader_ideology = conservatism } } #placeholder for now
					}
					10 = {
						set_state_flag = db_state_liberal
						PREV = { 
							add_to_variable = {
								var = total_state_liberal
								value = 1
								tooltip = add_total_state_liberal
							}
						}
						add_dynamic_modifier = {
							modifier = db_state_modifier_liberal
							scope = THIS
							
						}
						modifier = { factor = 2 PREV = { has_country_leader_ideology = liberalism } }
					}
				}
			}
			var:THIS.election_chance_lose = {
				set_temp_variable = {
					var = governor_chance_neutrality
					value = party_popularity_100@neutrality
				}
				set_temp_variable = {
					var = governor_chance_communism
					value = party_popularity_100@communism
				}
				set_temp_variable = {
					var = governor_chance_fascism
					value = party_popularity_100@fascism
				}
				var:governor_chance_neutrality = {
					set_state_flag = db_state_neutral
					PREV = { 
						add_to_variable = {
							var = total_state_neutral
							value = 1
							tooltip = add_total_state_neutral
						}
					}
					add_dynamic_modifier = {
						modifier = db_state_modifier_neutral
						scope = THIS
						
					}
				}	
				var:governor_chance_communism = {
					set_state_flag = db_state_communist
					PREV = {
						add_to_variable = {
							var = total_state_communist
							value = 1
							tooltip = add_total_state_communist
						}
					}
					add_dynamic_modifier = {
						modifier = db_state_modifier_communist
						scope = THIS
						
					}
				}
				var:governor_chance_fascism = {
					set_state_flag = db_state_fascist
					PREV = {
						add_to_variable = {
							var = total_state_fascist
							value = 1
							tooltip = add_total_state_fascist
						}
					}
					add_dynamic_modifier = {
						modifier = db_state_modifier_fascist
						scope = THIS
						
					}
				}
			}
		}
	}
}
