
#ON STARTUP
on_actions = {
	on_startup = {
		effect = {
			every_country = {
				set_variable = { THIS.db_spending_cost_modifier_base = 1 }
				
				#infantry
				set_variable = { THIS.db_military_production_infantry_cost_base = 83 } #base cost of a infantry weapon
				set_variable = { THIS.db_military_production_infantry_cost = THIS.db_military_production_infantry_cost_base }
				multiply_variable = { THIS.db_military_production_infantry_cost = THIS.db_spending_cost_modifier }
				
				#artillery
				set_variable = { THIS.db_military_production_artillery_cost_base = 83 } #base cost of a artillery weapon
				set_variable = { THIS.db_military_production_artillery_cost = THIS.db_military_production_artillery_cost_base }
				multiply_variable = { THIS.db_military_production_artillery_cost = THIS.db_spending_cost_modifier }
				
				#anti_air
				set_variable = { THIS.db_military_production_anti_air_cost_base = 83 } #base cost of a anti_air weapon
				set_variable = { THIS.db_military_production_anti_air_cost = THIS.db_military_production_anti_air_cost_base }
				multiply_variable = { THIS.db_military_production_anti_air_cost = THIS.db_spending_cost_modifier }
				
				#anti_tank
				set_variable = { THIS.db_military_production_anti_tank_cost_base = 83 } #base cost of a anti_tank weapon
				set_variable = { THIS.db_military_production_anti_tank_cost = THIS.db_military_production_anti_tank_cost_base }
				multiply_variable = { THIS.db_military_production_anti_tank_cost = THIS.db_spending_cost_modifier }
				
				#rocket
				set_variable = { THIS.db_military_production_rocket_cost_base = 83 } #base cost of a rocket weapon
				set_variable = { THIS.db_military_production_rocket_cost = THIS.db_military_production_rocket_cost_base }
				multiply_variable = { THIS.db_military_production_rocket_cost = THIS.db_spending_cost_modifier }
				
				#support
				set_variable = { THIS.db_military_production_support_cost_base = 83 } #base cost of a support weapon
				set_variable = { THIS.db_military_production_support_cost = THIS.db_military_production_support_cost_base }
				multiply_variable = { THIS.db_military_production_support_cost = THIS.db_spending_cost_modifier }
				
				#motorized
				set_variable = { THIS.db_military_production_motorized_cost_base = 83 } #base cost of a motorized weapon
				set_variable = { THIS.db_military_production_motorized_cost = THIS.db_military_production_motorized_cost_base }
				multiply_variable = { THIS.db_military_production_motorized_cost = THIS.db_spending_cost_modifier }
				
				#mechanized
				set_variable = { THIS.db_military_production_mechanized_cost_base = 83 } #base cost of a mechanized weapon
				set_variable = { THIS.db_military_production_mechanized_cost = THIS.db_military_production_mechanized_cost_base }
				multiply_variable = { THIS.db_military_production_mechanized_cost = THIS.db_spending_cost_modifier }
				
				#capital_ship
				set_variable = { THIS.db_military_production_capital_ship_cost_base = 83 } #base cost of a capital_ship weapon
				set_variable = { THIS.db_military_production_capital_ship_cost = THIS.db_military_production_capital_ship_cost_base }
				multiply_variable = { THIS.db_military_production_capital_ship_cost = THIS.db_spending_cost_modifier }
				
				#submarine
				set_variable = { THIS.db_military_production_submarine_cost_base = 83 } #base cost of a submarine weapon
				set_variable = { THIS.db_military_production_submarine_cost = THIS.db_military_production_submarine_cost_base }
				multiply_variable = { THIS.db_military_production_submarine_cost = THIS.db_spending_cost_modifier }
				
				#carrier
				set_variable = { THIS.db_military_production_carrier_cost_base = 83 } #base cost of a carrier weapon
				set_variable = { THIS.db_military_production_carrier_cost = THIS.db_military_production_carrier_cost_base }
				multiply_variable = { THIS.db_military_production_carrier_cost = THIS.db_spending_cost_modifier }
				
				#screen_ship
				set_variable = { THIS.db_military_production_screen_ship_cost_base = 83 } #base cost of a screen_ship weapon
				set_variable = { THIS.db_military_production_screen_ship_cost = THIS.db_military_production_screen_ship_cost_base }
				multiply_variable = { THIS.db_military_production_screen_ship_cost = THIS.db_spending_cost_modifier }
				
				#fighter
				set_variable = { THIS.db_military_production_fighter_cost_base = 83 } #base cost of a fighter weapon
				set_variable = { THIS.db_military_production_fighter_cost = THIS.db_military_production_fighter_cost_base }
				multiply_variable = { THIS.db_military_production_fighter_cost = THIS.db_spending_cost_modifier }
				
				#heavy_fighter
				set_variable = { THIS.db_military_production_heavy_fighter_cost_base = 83 } #base cost of a heavy_fighter weapon
				set_variable = { THIS.db_military_production_heavy_fighter_cost = THIS.db_military_production_heavy_fighter_cost_base }
				multiply_variable = { THIS.db_military_production_heavy_fighter_cost = THIS.db_spending_cost_modifier }
				
				#cas
				set_variable = { THIS.db_military_production_cas_cost_base = 83 } #base cost of a cas weapon
				set_variable = { THIS.db_military_production_cas_cost = THIS.db_military_production_cas_cost_base }
				multiply_variable = { THIS.db_military_production_cas_cost = THIS.db_spending_cost_modifier }
				
				#interceptor
				set_variable = { THIS.db_military_production_interceptor_cost_base = 83 } #base cost of a interceptor weapon
				set_variable = { THIS.db_military_production_interceptor_cost = THIS.db_military_production_interceptor_cost_base }
				multiply_variable = { THIS.db_military_production_interceptor_cost = THIS.db_spending_cost_modifier }
				
				#strategic_bomber
				set_variable = { THIS.db_military_production_strategic_bomber_cost_base = 83 } #base cost of a strategic_bomber weapon
				set_variable = { THIS.db_military_production_strategic_bomber_cost = THIS.db_military_production_strategic_bomber_cost_base }
				multiply_variable = { THIS.db_military_production_strategic_bomber_cost = THIS.db_spending_cost_modifier }
				
				#tactical_bomber
				set_variable = { THIS.db_military_production_tactical_bomber_cost_base = 83 } #base cost of a tactical_bomber weapon
				set_variable = { THIS.db_military_production_tactical_bomber_cost = THIS.db_military_production_tactical_bomber_cost_base }
				multiply_variable = { THIS.db_military_production_tactical_bomber_cost = THIS.db_spending_cost_modifier }
				
				#naval_bomber
				set_variable = { THIS.db_military_production_naval_bomber_cost_base = 83 } #base cost of a naval_bomber weapon
				set_variable = { THIS.db_military_production_naval_bomber_cost = THIS.db_military_production_naval_bomber_cost_base }
				multiply_variable = { THIS.db_military_production_naval_bomber_cost = THIS.db_spending_cost_modifier }
				
				#maritime_patrol_plane
				set_variable = { THIS.db_military_production_maritime_patrol_plane_cost_base = 83 } #base cost of a maritime_patrol_plane weapon
				set_variable = { THIS.db_military_production_maritime_patrol_plane_cost = THIS.db_military_production_maritime_patrol_plane_cost_base }
				multiply_variable = { THIS.db_military_production_maritime_patrol_plane_cost = THIS.db_spending_cost_modifier }
				
				#scout_plane
				set_variable = { THIS.db_military_production_scout_plane_cost_base = 83 } #base cost of a scout_plane weapon
				set_variable = { THIS.db_military_production_scout_plane_cost = THIS.db_military_production_scout_plane_cost_base }
				multiply_variable = { THIS.db_military_production_scout_plane_cost = THIS.db_spending_cost_modifier }
				
				#air_transport
				set_variable = { THIS.db_military_production_air_transport_cost_base = 83 } #base cost of a air_transport weapon
				set_variable = { THIS.db_military_production_air_transport_cost = THIS.db_military_production_air_transport_cost_base }
				multiply_variable = { THIS.db_military_production_air_transport_cost = THIS.db_spending_cost_modifier }
				
				#suicide
				set_variable = { THIS.db_military_production_suicide_cost_base = 83 } #base cost of a suicide weapon
				set_variable = { THIS.db_military_production_suicide_cost = THIS.db_military_production_suicide_cost_base }
				multiply_variable = { THIS.db_military_production_suicide_cost = THIS.db_spending_cost_modifier }
				
				#missile
				set_variable = { THIS.db_military_production_missile_cost_base = 83 } #base cost of a missile weapon
				set_variable = { THIS.db_military_production_missile_cost = THIS.db_military_production_missile_cost_base }
				multiply_variable = { THIS.db_military_production_missile_cost = THIS.db_spending_cost_modifier }
				
				#convoy
				set_variable = { THIS.db_military_production_convoy_cost_base = 83 } #base cost of a convoy weapon
				set_variable = { THIS.db_military_production_convoy_cost = THIS.db_military_production_convoy_cost_base }
				multiply_variable = { THIS.db_military_production_convoy_cost = THIS.db_spending_cost_modifier }
				
				#armor
				set_variable = { THIS.db_military_production_armor_cost_base = 83 } #base cost of a armor weapon
				set_variable = { THIS.db_military_production_armor_cost = THIS.db_military_production_armor_cost_base }
				multiply_variable = { THIS.db_military_production_armor_cost = THIS.db_spending_cost_modifier }
				
				add_to_array = {
				    array = THIS.db_military_production
				    value = THIS.total_equipment_produced_infantry
				    index = 0
				}
				add_to_array = {
				    array = THIS.db_military_production_cost # infantry cost
				    value = THIS.db_military_production_infantry_cost
				    index = 0
				}
				
				#artillery
				add_to_array = {
				    array = THIS.db_military_production
				    value = THIS.total_equipment_produced_artillery
				    index = 1
				}
				add_to_array = {
				    array = THIS.db_military_production_cost # artillery cost
				    value = THIS.db_military_production_artillery_cost
				    index = 1
				}
				
				#anti_air
				add_to_array = {
				    array = THIS.db_military_production
				    value = THIS.total_equipment_produced_anti_air
				    index = 2
				}
				add_to_array = {
				    array = THIS.db_military_production_cost # anti_air cost
				    value = THIS.db_military_production_anti_air_cost
				    index = 2
				}
				
				#anti_tank
				add_to_array = {
				    array = THIS.db_military_production
				    value = THIS.total_equipment_produced_anti_tank
				    index = 3
				}
				add_to_array = {
				    array = THIS.db_military_production_cost # anti_tank cost
				    value = THIS.db_military_production_anti_tank_cost
				    index = 3
				}
				
				#rocket
				add_to_array = {
				    array = THIS.db_military_production
				    value = THIS.total_equipment_produced_rocket
				    index = 4
				}
				add_to_array = {
				    array = THIS.db_military_production_cost # rocket cost
				    value = THIS.db_military_production_rocket_cost
				    index = 4
				}
				
				#support
				add_to_array = {
				    array = THIS.db_military_production
				    value = THIS.total_equipment_produced_support
				    index = 5
				}
				add_to_array = {
				    array = THIS.db_military_production_cost # support cost
				    value = THIS.db_military_production_support_cost
				    index = 5
				}
				
				#motorized
				add_to_array = {
				    array = THIS.db_military_production
				    value = THIS.total_equipment_produced_motorized
				    index = 6
				}
				add_to_array = {
				    array = THIS.db_military_production_cost # motorized cost
				    value = THIS.db_military_production_motorized_cost
				    index = 6
				}
				
				#mechanized
				add_to_array = {
				    array = THIS.db_military_production
				    value = THIS.total_equipment_produced_mechanized
				    index = 7
				}
				add_to_array = {
				    array = THIS.db_military_production_cost # mechanized cost
				    value = THIS.db_military_production_mechanized_cost
				    index = 7
				}
				
				#capital_ship
				add_to_array = {
				    array = THIS.db_military_production
				    value = THIS.total_equipment_produced_capital_ship
				    index = 8
				}
				add_to_array = {
				    array = THIS.db_military_production_cost # capital_ship cost
				    value = THIS.db_military_production_capital_ship_cost
				    index = 8
				}
				
				#submarine
				add_to_array = {
				    array = THIS.db_military_production
				    value = THIS.total_equipment_produced_submarine
				    index = 9
				}
				add_to_array = {
				    array = THIS.db_military_production_cost # submarine cost
				    value = THIS.db_military_production_submarine_cost
				    index = 9
				}
				
				#carrier
				add_to_array = {
				    array = THIS.db_military_production
				    value = THIS.total_equipment_produced_carrier
				    index = 10
				}
				add_to_array = {
				    array = THIS.db_military_production_cost # carrier cost
				    value = THIS.db_military_production_carrier_cost
				    index = 10
				}
				
				#screen_ship
				add_to_array = {
				    array = THIS.db_military_production
				    value = THIS.total_equipment_produced_screen_ship
				    index = 11
				}
				add_to_array = {
				    array = THIS.db_military_production_cost # screen_ship cost
				    value = THIS.db_military_production_screen_ship_cost
				    index = 11
				}
				
				#fighter
				add_to_array = {
				    array = THIS.db_military_production
				    value = THIS.total_equipment_produced_fighter
				    index = 12
				}
				add_to_array = {
				    array = THIS.db_military_production_cost # fighter cost
				    value = THIS.db_military_production_fighter_cost
				    index = 12
				}
				
				#heavy_fighter
				add_to_array = {
				    array = THIS.db_military_production
				    value = THIS.total_equipment_produced_heavy_fighter
				    index = 13
				}
				add_to_array = {
				    array = THIS.db_military_production_cost # heavy_fighter cost
				    value = THIS.db_military_production_heavy_fighter_cost
				    index = 13
				}
				
				#cas
				add_to_array = {
				    array = THIS.db_military_production
				    value = THIS.total_equipment_produced_cas
				    index = 14
				}
				add_to_array = {
				    array = THIS.db_military_production_cost # cas cost
				    value = THIS.db_military_production_cas_cost
				    index = 14
				}
				
				#interceptor
				add_to_array = {
				    array = THIS.db_military_production
				    value = THIS.total_equipment_produced_interceptor
				    index = 15
				}
				add_to_array = {
				    array = THIS.db_military_production_cost # interceptor cost
				    value = THIS.db_military_production_interceptor_cost
				    index = 15
				}
				
				#strategic_bomber
				add_to_array = {
				    array = THIS.db_military_production
				    value = THIS.total_equipment_produced_strategic_bomber
				    index = 16
				}
				add_to_array = {
				    array = THIS.db_military_production_cost # strategic_bomber cost
				    value = THIS.db_military_production_strategic_bomber_cost
				    index = 16
				}
				
				#tactical_bomber
				add_to_array = {
				    array = THIS.db_military_production
				    value = THIS.total_equipment_produced_tactical_bomber
				    index = 17
				}
				add_to_array = {
				    array = THIS.db_military_production_cost # tactical_bomber cost
				    value = THIS.db_military_production_tactical_bomber_cost
				    index = 17
				}
				
				#naval_bomber
				add_to_array = {
				    array = THIS.db_military_production
				    value = THIS.total_equipment_produced_naval_bomber
				    index = 18
				}
				add_to_array = {
				    array = THIS.db_military_production_cost # naval_bomber cost
				    value = THIS.db_military_production_naval_bomber_cost
				    index = 18
				}
				
				#maritime_patrol_plane
				add_to_array = {
				    array = THIS.db_military_production
				    value = THIS.total_equipment_produced_maritime_patrol_plane
				    index = 19
				}
				add_to_array = {
				    array = THIS.db_military_production_cost # maritime_patrol_plane cost
				    value = THIS.db_military_production_maritime_patrol_plane_cost
				    index = 19
				}
				
				#scout_plane
				add_to_array = {
				    array = THIS.db_military_production
				    value = THIS.total_equipment_produced_scout_plane
				    index = 20
				}
				add_to_array = {
				    array = THIS.db_military_production_cost # scout_plane cost
				    value = THIS.db_military_production_scout_plane_cost
				    index = 20
				}
				
				#air_transport
				add_to_array = {
				    array = THIS.db_military_production
				    value = THIS.total_equipment_produced_air_transport
				    index = 21
				}
				add_to_array = {
				    array = THIS.db_military_production_cost # air_transport cost
				    value = THIS.db_military_production_air_transport_cost
				    index = 21
				}
				
				#suicide
				add_to_array = {
				    array = THIS.db_military_production
				    value = THIS.total_equipment_produced_suicide
				    index = 22
				}
				add_to_array = {
				    array = THIS.db_military_production_cost # suicide cost
				    value = THIS.db_military_production_suicide_cost
				    index = 22
				}
				
				#missile
				add_to_array = {
				    array = THIS.db_military_production
				    value = THIS.total_equipment_produced_missile
				    index = 23
				}
				add_to_array = {
				    array = THIS.db_military_production_cost # missile cost
				    value = THIS.db_military_production_missile_cost
				    index = 23
				}
				
				#convoy
				add_to_array = {
				    array = THIS.db_military_production
				    value = THIS.total_equipment_produced_convoy
				    index = 24
				}
				add_to_array = {
				    array = THIS.db_military_production_cost # convoy cost
				    value = THIS.db_military_production_convoy_cost
				    index = 24
				}
				
				#armor
				add_to_array = {
				    array = THIS.db_military_production
				    value = THIS.total_equipment_produced_armor
				    index = 25
				}
				add_to_array = {
				    array = THIS.db_military_production_cost # armor cost
				    value = THIS.db_military_production_armor_cost
				    index = 25
				}
				
				for_loop_effect = {
					start = 0
					end = 25
					add = 1
					value = v
					add_to_array = {
						array = THIS.military_spending_this_week
						value = 0
						index = v
					}
				}
				
				for_loop_effect = {
					start = 0
					end = 25
					add = 1
					value = v
					add_to_array = {
						array = THIS.military_spending_last_week
						value = 0
						index = v
					}
				}
			}
		}
	}
	

#Weekly Spending Calculation

	on_weekly = {
		effect = {
			every_country = {

			#MILITARY COSTS BASED ON ECONOMIC LAW
				set_variable = { THIS.db_spending_cost_modifier = THIS.db_spending_cost_modifier_base }
				if = { limit = { has_idea = undisturbed_isolation } multiply_variable = { THIS.db_spending_cost_modifier = 2 } }
				if = { limit = { has_idea = isolation } multiply_variable = { THIS.db_spending_cost_modifier = 1.5 } }
				if = { limit = { has_idea = civilian_economy } multiply_variable = { THIS.db_spending_cost_modifier = 1 } }
				if = { limit = { has_idea = low_economic_mobilisation OR = { has_idea = new_economic_policy } } multiply_variable = { THIS.db_spending_cost_modifier 0.85 } }
				if = { limit = { has_idea = partial_economic_mobilisation OR = { has_idea = new_economic_policy_2 } } multiply_variable = { THIS.db_spending_cost_modifier = 0.7 } }
				if = { limit = { has_idea = low_economic_mobilisation } multiply_variable = { THIS.db_spending_cost_modifier = 0.55 } }
				if = { limit = { has_idea = war_economy } multiply_variable = { THIS.db_spending_cost_modifier = 0.4 } }
				if = { limit = { has_idea = tot_economic_mobilisation OR = { has_idea = SPR_collectivized_society } } multiply_variable = { THIS.db_spending_cost_modifier = 0.3 } }

			#CALCULATE WEEKLY MILITARY SPENDING
				for_loop_effect = {
					start = 0
					end = 25
					add = 1
					value = v
				
				
				#LOCALIZE SPENDING TO COUNTRY
					set_temp_variable = { spending = THIS.db_military_production^v }
					multiply_temp_variable = { spending = THIS.db_military_production_cost^v }
					multiply_temp_variable = { spending = THIS.db_national_inflation }
					divide_temp_variable = { spending = 1000 } # quantify by thousands
					set_variable = { THIS.military_spending_this_week^v = spending }
					
				#ADD SPENDING TO "ADD_TO_TOTAL"	
					set_temp_variable = { new_total_spending = THIS.military_spending_this_week^v }
					subtract_temp_variable = { new_total_spending = THIS.military_spending_last_week^v }
					add_to_variable = { THIS.total_military_spending_add_to_total = new_total_spending }
				
					set_variable = { THIS.military_spending_last_week^v = THIS.military_spending_this_week^v }
					
					clamp_variable = {
						var = THIS.total_military_spending_add_to_total
						min = 0
						max = 2000000
					}
				}
				
			#ADD "ADD_TO_TOTAL" to Total Military Spending
				db_national_military_spending_initialize_overflow_value = yes
				
				every_owned_state = {
					set_variable = { THIS.db_state_military_staff_spending = 0 }
					add_to_variable = { THIS.db_state_military_staff_spending = THIS.db_state_military_jobs }
					multiply_variable = { THIS.db_state_military_staff_spending = THIS.db_state_daily_wage }
					multiply_variable = { THIS.db_state_military_staff_spending = 7 } #quantify to week
					add_to_variable = { PREV.national_state_militrary_staff_spending_add_to_total = THIS.db_state_military_staff_spending }
				}
				
				db_national_military_staff_spending_initialize_overflow_value = yes
				
				if = {
					limit = { is_ai = no }
					log = "Military spending successfully initialized."
				}
			}
		}
	}

    on_daily = {
        effect = {
            every_state = {
                for_loop_effect = {
                    start = 0
                    end = 14
                    add = 1
                    value = v
                    round_variable = THIS.db_national_military_spending_overflow_check^v
                    set_temp_variable = { next_digit = v }
                    add_to_temp_variable = { next_digit = 1 }
                    set_temp_variable = { this_digit = v }
                    set_temp_variable = { last_digit = v }
                    add_to_temp_variable = { last_digit = -1 }
                    if = {
                        limit = { check_variable = { THIS.db_national_military_spending_overflow_check^this_digit > 9 } }
                        add_to_variable = { THIS.db_national_military_spending_overflow_check^next_digit = 1 }
                        add_to_variable = { THIS.db_national_military_spending_overflow_check^this_digit = -10 }
                        #log = "THIS.db_national_military_spending: Digit overflow found!"
                        #log = "THIS.db_national_military_spending: New total is [?THIS.db_national_military_spending_overflow_check^6][?THIS.db_national_military_spending_overflow_check^5][?THIS.db_national_military_spending_overflow_check^4][?THIS.db_national_military_spending_overflow_check^3][?THIS.db_national_military_spending_overflow_check^2][?THIS.db_national_military_spending_overflow_check^1][?THIS.db_national_military_spending_overflow_check^0]"
                    }
                    if = {
                        limit = { check_variable = { THIS.db_national_military_spending_overflow_check^this_digit < 0 } }
                        #log = "Found negative digit in THIS.db_national_military_spending_overflow_check^[?this_digit!]"
                        for_loop_effect = {
                            start = 0
                            add = 1
                            end = 14
                            value = y
                            break = can_borrow_digit
                            set_temp_variable = { borrowable_digit = y }
                            if = {
                                limit = {
                                    check_variable = { borrowable_digit > this_digit }
                                    check_variable = { THIS.db_national_military_spending_overflow_check^y > 0 }
                                }
                                set_state_flag = db_national_military_spending_overflow_check_borrowable_digit
                                set_variable = { THIS.db_national_military_spending_overflow_check_borrowed_digit = y }
                                #log = "THIS.db_national_military_spending: Found borrowable digit!"
                                clear_variable = THIS.db_national_military_spending_overflow_check_borrowed_digit
                                set_temp_variable = { borrowed_digit = y }
                                set_temp_variable = { borrowed_digit_last_digit = borrowed_digit }
                                add_to_temp_variable = { borrowed_digit_last_digit = -1 }
                                add_to_variable = { THIS.db_national_military_spending_overflow_check^borrowed_digit = -1 }
                                add_to_variable = { THIS.db_national_military_spending_overflow_check^borrowed_digit_last_digit = 10 }
                                #log = "THIS.db_national_military_spending: New total is [?THIS.db_national_military_spending_overflow_check^6][?THIS.db_national_military_spending_overflow_check^5][?THIS.db_national_military_spending_overflow_check^4][?THIS.db_national_military_spending_overflow_check^3][?THIS.db_national_military_spending_overflow_check^2][?THIS.db_national_military_spending_overflow_check^1][?THIS.db_national_military_spending_overflow_check^0]"
                                set_temp_variable = { can_borrow_digit = 1 }
                            }
                        }
                        if = {
                            limit = { NOT = { has_state_flag = db_national_military_spending_overflow_check_borrowable_digit } }
                            if = {
                                limit = { NOT = { check_variable = { this_digit = 0 } } }
                                add_to_variable = { THIS.db_national_military_spending_overflow_check^last_digit = -10 }
                                add_to_variable = { THIS.db_national_military_spending_overflow_check^this_digit = 1 }
                                #log = "THIS.db_national_military_spending: No digit to borrow from. You're getting poorer. Whoops."
                                #log = "THIS.db_national_military_spending: New total is [?THIS.db_national_military_spending_overflow_check^6][?THIS.db_national_military_spending_overflow_check^5][?THIS.db_national_military_spending_overflow_check^4][?THIS.db_national_military_spending_overflow_check^3][?THIS.db_national_military_spending_overflow_check^2][?THIS.db_national_military_spending_overflow_check^1][?THIS.db_national_military_spending_overflow_check^0]"
                            }
                            if = {
                                limit = { check_variable = { this_digit = 0 }
                                check_variable = { THIS.db_national_military_spending_overflow_check^this_digit < 0 } }
                                if = {
                                    limit = { has_state_flag = db_national_military_spending_overflow_check_is_positive }
                                    set_state_flag = db_national_military_spending_overflow_check_is_negative
                                    clr_state_flag = db_national_military_spending_overflow_check_is_positive
                                    multiply_variable = { THIS.db_national_military_spending_overflow_check^0 = -1 }
                                    #log = "THIS.db_national_military_spending has gone negative!"
                                }
                                else_if = {
                                    set_state_flag = db_national_military_spending_overflow_check_is_positive
                                    clr_state_flag = db_national_military_spending_overflow_check_is_negative
                                    multiply_variable = { THIS.db_national_military_spending_overflow_check^0 = -1 }
                                    #log = "THIS.db_national_military_spending has gone positive!"
                                }
                            }
                        }
                    }
                }
            }
        }
    }
}