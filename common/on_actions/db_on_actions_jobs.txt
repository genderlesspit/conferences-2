on_actions = {

	on_startup = {
		effect = {
			every_country = {
				set_variable = { THIS.db_national_lfpr = .4 }
				every_state = {
					if = { limit = { has_state_category = city } set_variable = { var = THIS.db_state_base_wealth value = 6 } }
					if = { limit = { has_state_category = large_city } set_variable = { var = THIS.db_state_base_wealth value = 7 } }
					if = { limit = { has_state_category = megalopolis } set_variable = { var = THIS.db_state_base_wealth value = 8 } }
					if = { limit = { has_state_category = metropolis } set_variable = { var = THIS.db_state_base_wealth value = 9 } }
					if = { limit = { has_state_category = enclave } set_variable = { var = THIS.db_state_base_wealth value = 6 } }
					if = { limit = { has_state_category = large_town } set_variable = { var = THIS.db_state_base_wealth value = 5 } }
					if = { limit = { has_state_category = pastoral } set_variable = { var = THIS.db_state_base_wealth value = 3 } }
					if = { limit = { OR = { has_state_category = rural has_state_category = small_island has_state_category = tiny_island has_state_category = town } } set_variable = { var = THIS.db_state_base_wealth value = 4 } }
					if = { limit = { has_state_category = wasteland } set_variable = { var = THIS.db_state_base_wealth value = 1 } }
					set_variable = { var = THIS.db_state_base_jobs_percent value = THIS.db_state_base_wealth }
					clamp_variable = { var = THIS.db_state_base_jobs_percent min = 2 max = 7 }
					add_to_variable = { THIS.db_state_base_jobs_percent = 0.5 }
					divide_variable = { THIS.db_state_base_jobs_percent = 10 }
					set_variable = { THIS.db_state_lfpr = THIS.state_population_k }
					multiply_variable = { THIS.db_state_lfpr = PREV.db_national_lfpr }
					set_variable = { THIS.db_state_base_total_employed = THIS.db_state_lfpr }
					multiply_variable = { var = THIS.db_state_base_total_employed value = THIS.db_state_base_jobs_percent }
					set_variable = { THIS.db_state_base_wage_modifier = THIS.db_state_base_wealth }
					divide_variable = { THIS.db_state_base_wage_modifier = 10 }
					clamp_variable = { 
						var = THIS.db_state_base_wage_modifier
						min = 0.1
						max = 1
					}
					set_variable = { THIS.db_state_base_cost_of_living_modifier = THIS.db_state_base_wealth }
					divide_variable = { var = THIS.db_state_base_cost_of_living_modifier value = 10 }
					add_to_variable = { THIS.db_state_base_cost_of_living_modifier = 0.5 }
					multiply_variable = { THIS.db_state_base_cost_of_living_modifier = THIS.db_national_inflation }
				}
			}
		}
	}
	
	on_startup = {
		effect = {
			every_country = {
				set_variable = {
					var = THIS.db_state_employment_modifier
					value = 1
				}
				set_variable = { THIS.db_national_minimum_wage = 0.25 }
				set_variable = { THIS.db_national_inflation = 1 }
				set_variable = { THIS.db_national_work_hours_per_day = 8 }
				every_state = { set_variable = { THIS.db_state_consumer_debt_savings_thousands = 0 } }
				set_variable = { THIS.db_national_taxation_rate = 0.05 }
				country_event = { id = db_economic_hidden.1 days = 1 }	
				set_variable = { THIS.db_national_lfpr_base = 0.40 }
			}
		}
	}
	
	on_daily = {
		effect = { #Inflation and Prices Calculation
			every_country = {
				set_variable = { THIS.db_national_price_consumer_goods_modifier = -.35 }
				add_to_variable = { THIS.db_national_price_consumer_goods_modifier = THIS.modifier@consumer_goods_factor }
				every_state = {
					subtract_from_variable = { THIS.db_national_price_consumer_goods_modifier = THIS.db_state_daily_consumer_spending_total_thousands_ratio }
					divide_variable = { THIS.db_national_price_consumer_goods_modifier = PREV.num_owned_controlled_states }
				}
				divide_variable = { THIS.db_national_price_consumer_goods_modifier = -1 } #extra consumer goods lower prices, lower consumer goods heighten prices
				multiply_variable = { THIS.db_national_price_consumer_goods_modifier = THIS.db_national_inflation }
				subtract_from_variable = { THIS.db_national_consumption = THIS.db_national_price_consumer_goods_modifier }
				clamp_variable = {
					var = THIS.db_national_price_consumer_goods_modifier 
					min = -0.35
				}
				set_variable = { THIS.db_national_consumption = THIS.db_national_price_consumer_goods_modifier }
				multiply_variable = { THIS.db_national_consumption = 0.8 }
				subtract_from_variable = { THIS.db_national_consumption = PREV.db_national_taxation_rate }
				multiply_variable = { THIS.db_national_consumption = -1 }
				clamp_variable = {
					var = THIS.db_national_consumption 
					max = 0
				}
				
				add_to_variable = {
					THIS.db_national_consumption = THIS.db_national_consumption_modifier 
				}
				set_variable = { THIS.db_national_inflation_rate = THIS.db_national_price_consumer_goods_modifier } 
				divide_variable = { THIS.db_national_inflation_rate = 100 } #make inflation slow
				add_to_variable = { THIS.db_national_inflation = THIS.db_national_inflation_rate }
				set_variable = { THIS.db_national_inflation_rate_yearly = THIS.db_national_inflation_rate }
				multiply_variable = { THIS.db_national_inflation_rate_yearly = 365 }
			}
		}
	}

	on_daily = { #Labor Force Participation Rate calculation
		effect = {
			every_country = {
				set_variable = { THIS.db_national_lfpr = THIS.db_national_lfpr_base }
				add_to_variable = { THIS.db_national_lfpr = THIS.db_national_lfpr_modifier }
				every_owned_state = {
					set_variable = { THIS.db_state_lfpr = THIS.state_population_k }
					multiply_variable = { THIS.db_state_lfpr = PREV.db_national_lfpr }
				}
			}
		}
	}
	
	
	on_daily = {
		effect = {
			every_country = { #calculate total jobs base + military
				set_variable = { THIS.db_deployed_manpower_ratio = THIS.deployed_army_manpower_k }
				add_to_variable = { THIS.db_deployed_manpower_ratio = THIS.deployed_navy_manpower_k }
				add_to_variable = { THIS.db_deployed_manpower_ratio = THIS.deployed_airforce_manpower_k }
				divide_variable = { THIS.db_deployed_manpower_ratio = THIS.max_available_manpower_k }
				set_variable = { THIS.db_reserved_manpower_ratio = 1 }
				subtract_from_variable = { THIS.db_reserved_manpower_ratio = THIS.db_deployed_manpower }
				every_state = { #set_military_jobs
					limit = { is_owned_by = PREV }
					set_variable = { THIS.db_state_military_jobs = THIS.state_population_k }
					multiply_variable = { THIS.db_state_military_jobs = PREV.modifier@conscription }
					multiply_variable = { THIS.db_state_military_jobs = PREV.db_deployed_manpower_ratio }
					set_variable = { THIS.db_state_total_employed = THIS.db_state_base_total_employed }#calculate total employed base + military
					add_to_variable = { THIS.db_state_total_employed = THIS.db_state_military_jobs }
				}
				every_state = { #calculate industrial employment modifier
					limit = { is_owned_by = PREV }
					set_variable = { THIS.db_state_employment_modifier = 1 }
					add_to_variable = { THIS.db_state_employment_modifier = THIS.non_damaged_building_level@arms_factory }
					add_to_variable = { THIS.db_state_employment_modifier = THIS.non_damaged_building_level@industrial_complex }
					add_to_variable = { THIS.db_state_employment_modifier = THIS.non_damaged_building_level@dockyard }
					divide_variable = { THIS.db_state_employment_modifier = THIS.modifier@local_building_slots } #should read between 1 and 0
					clamp_variable = { var = THIS.db_state_employment_modifier min = 0 max = 1 } #between no and double employment
					set_variable = { THIS.db_industrial_capacity = PREV.modifier@industrial_capacity_factory }
					add_to_variable = { THIS.db_state_employment_modifier = PREV.modifier@industrial_capacity_dockyard }
					add_to_variable = { THIS.db_state_employment_modifier = THIS.db_industrial_capacity }
					divide_variable = { THIS.db_state_employment_modifier = 2 }
					clamp_variable = { var = THIS.db_state_employment_modifier min = 0 max = 0.99 }
					############### CALCULATE EMPLOYMENT # based on modifier
					set_variable = { THIS.db_state_total_unemployed = THIS.db_state_lfpr }
					subtract_from_variable = { THIS.db_state_total_unemployed = THIS.db_state_total_employed }
					set_variable = { THIS.db_state_total_added_jobs = THIS.db_state_total_unemployed }
					multiply_variable = { THIS.db_state_total_added_jobs = THIS.db_state_employment_modifier }
					add_to_variable = { THIS.db_state_total_employed = THIS.db_state_total_added_jobs }
					subtract_from_variable = { THIS.db_state_total_unemployed = THIS.db_state_total_added_jobs }
					set_variable = { THIS.db_state_unemployed_percent = THIS.db_state_total_unemployed }
					divide_variable = { THIS.db_state_unemployed_percent = THIS.db_state_lfpr }
					clamp_variable = {
						var = THIS.db_state_total_unemployed
						min = 0
						max = THIS.db_state_lfpr
					}
					clamp_variable = {
						var = THIS.db_state_total_employed
						min = 0
						max = THIS.db_state_lfpr
					}
				}
			}
		}
	}
	on_daily = { #national unemployment rate calculation
		effect = {
			every_country = {
				set_variable = { THIS.db_national_unemployment_rate = 0 }
				every_owned_state = {
					add_to_variable = { PREV.db_national_unemployment_rate = THIS.db_state_unemployed_percent }
				}
				divide_variable = { THIS.db_national_unemployment_rate = THIS.num_owned_controlled_states }			
			}
		}
	}

	on_daily = { #wage and salary calculation
		effect = {
			every_country = {
				every_owned_state = {
					#limit = { is_controlled_by = PREV }
					set_variable = { THIS.db_state_salary_total = PREV.db_national_minimum_wage }
					multiply_variable = { THIS.db_state_salary_total = PREV.db_national_work_hours_per_day }
					set_variable = { THIS.db_state_salary_total_modifier = 0 }
					add_to_variable = { THIS.db_state_salary_total_modifier = THIS.db_state_base_wage_modifier }
					add_to_variable = { THIS.db_state_salary_total_modifier = THIS.db_state_total_unemployed_percent }
					divide_variable = {	THIS.db_state_salary_total_modifier = 2 }
					clamp_variable = { var = THIS.db_state_salary_total_modifier min = 0.1 max = 1 }
					multiply_variable = { THIS.db_state_salary_total = THIS.db_state_salary_total_modifier }
					set_variable = { THIS.db_state_daily_wage = THIS.db_state_salary_total }
					multiply_variable = { THIS.db_state_salary_total = db_state_total_employed }
					divide_variable = { THIS.db_state_salary_total = 1000 }
					set_variable = { THIS.db_state_daily_income_total_thousands = THIS.db_state_salary_total }
					set_variable = { THIS.db_state_taxes_raised_thousands = THIS.db_state_daily_income_total_thousands }
					multiply_variable = { THIS.db_state_taxes_raised_thousands = PREV.db_national_taxation_rate }
					subtract_from_variable = { THIS.db_state_daily_income_total_thousands = THIS.db_state_taxes_raised_thousands }
					set_variable = { THIS.db_state_daily_wage_total = THIS.db_state_salary_total }
					multiply_variable = { THIS.db_state_salary_total = 365 }
				}
			}
		}
	}
	
	on_daily = {
		effect = {
			every_country = {
				set_variable = { THIS.db_national_daily_wage_average = 0 }
				set_variable = { THIS.db_national_daily_income_total_thousands = 0 }
				every_owned_state = {
					add_to_variable = { PREV.db_national_daily_income_total_thousands = THIS.db_state_daily_aggregate_income_thousands }
					add_to_variable = { PREV.db_national_daily_wage_average = THIS.db_state_daily_wage }
				}
				divide_variable = { THIS.db_national_daily_wage_average = THIS.num_owned_controlled_states }
			}
		}
	}

	on_daily = {
		effect = {
			every_country = {
				every_owned_state = {					
					set_variable = { THIS.db_state_consumer_spending_base_food = 0.3 }
					add_to_variable = { THIS.db_state_consumer_spending_base_food = PREV.db_national_consumer_goods_food_modifier }
					add_to_variable = { THIS.db_state_consumer_spending_base_food = PREV.db_national_price_consumer_goods_modifier }
					add_to_variable = { THIS.db_state_consumer_spending_base_food = PREV.db_national_consumption }
					clamp_variable = { var = THIS.db_state_consumer_spending_base_food min = 0.05 max = 1 }
					#set_variable = { THIS.db_state_consumer_spending_base_tobacco = 0.03 }
					#add_to_variable = { THIS.db_state_consumer_spending_base_tobacco = PREV.db_national_consumer_goods_tobacco_modifier }
					#add_to_variable = { THIS.db_state_consumer_spending_base_tobacco = PREV.db_national_price_consumer_goods_modifier }
					#add_to_variable = { THIS.db_state_consumer_spending_base_tobacco = PREV.db_national_consumption }
					#clamp_variable = { var = THIS.db_state_consumer_spending_base_tobacco min = 0.002 max = 1 }
					set_variable = { THIS.db_state_consumer_spending_base_housing = 0.28 }
					add_to_variable = { THIS.db_state_consumer_spending_base_housing = PREV.db_national_consumer_goods_housing_modifier }
					clamp_variable = { var = THIS.db_state_consumer_spending_base_housing min = 0.28 max = 1 }
					set_variable = { THIS.db_state_consumer_spending_base_clothing = 0.15 }
					add_to_variable = { THIS.db_state_consumer_spending_base_clothing = PREV.db_national_consumer_goods_clothing_modifier }
					add_to_variable = { THIS.db_state_consumer_spending_base_clothing = PREV.db_national_price_consumer_goods_modifier }
					add_to_variable = { THIS.db_state_consumer_spending_base_clothing = PREV.db_national_consumption }
					set_variable = { THIS.db_state_consumer_spending_base_medical= 0.06 max = 1 }
					add_to_variable = { THIS.db_state_consumer_spending_base_medical = PREV.db_national_consumer_goods_medical_modifier }
					add_to_variable = { THIS.db_state_consumer_spending_base_medical = PREV.db_national_price_consumer_goods_modifier }
					add_to_variable = { THIS.db_state_consumer_spending_base_medical = PREV.db_national_consumption }
					clamp_variable = { var = THIS.db_state_consumer_spending_base_medical min = 0.02 max = 1 }
					set_variable = { THIS.db_state_daily_consumer_spending_total_thousands_base = 1 }
					set_variable = { THIS.db_state_daily_consumer_spending_total_thousands = 0 }
					add_to_variable = { THIS.db_state_daily_consumer_spending_total_thousands = THIS.db_state_consumer_spending_base_food }
					add_to_variable = { THIS.db_state_daily_consumer_spending_total_thousands = THIS.db_state_consumer_spending_base_tobacco }
					add_to_variable = { THIS.db_state_daily_consumer_spending_total_thousands = THIS.db_state_consumer_spending_base_housing }
					add_to_variable = { THIS.db_state_daily_consumer_spending_total_thousands = THIS.db_state_consumer_spending_base_medical }
					add_to_variable = { THIS.db_state_daily_consumer_spending_total_thousands = THIS.db_state_consumer_spending_base_clothing }
					subtract_from_variable = { THIS.db_state_daily_consumer_spending_total_thousands = THIS.db_state_base_cost_of_living_modifier }
					clamp_variable = { var = THIS.db_state_daily_consumer_spending_total_thousands min = 0.5 max = 999 }
					subtract_from_variable = { THIS.db_state_daily_consumer_spending_total_thousands_base = THIS.db_state_daily_consumer_spending_total_thousands }
					#set demand in relation to how much people are spending
					set_variable = { THIS.db_state_consumer_goods_demand = THIS.db_state_daily_consumer_spending_total_thousands_base } #positive means spending is higher than income
					#make percentage quantifiable
					multiply_variable = { THIS.db_state_daily_consumer_spending_total_thousands = THIS.db_state_daily_wage }
					set_variable = { THIS.db_state_total_daily_consumer_spending_per_capita = THIS.db_state_daily_consumer_spending_total_thousands }
					multiply_variable = { THIS.db_state_daily_consumer_spending_total_thousands = THIS.state_population_k }
					#divide_variable = { THIS.db_state_daily_consumer_spending_total_thousands = 4 } #for a standard family of four
					divide_variable = { THIS.db_state_daily_consumer_spending_total_thousands = 1000 } #
					#set inflation
					multiply_variable = { THIS.db_state_daily_consumer_spending_total_thousands =  PREV.db_national_inflation }
					set_variable = { THIS.db_state_daily_aggregate_income_thousands = THIS.db_state_daily_income_total_thousands }
					subtract_from_variable = { THIS.db_state_daily_aggregate_income_thousands = THIS.db_state_daily_consumer_spending_total_thousands }
					#add to debt/savings
				}
			}
		}
	}
}